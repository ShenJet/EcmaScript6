<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
<script>
    //demo
    var promise = new Promise((resolve, reject) => {
            setTimeout(resolve, 2000, 'done');
    });
    
    promise.then((value) => {
        console.log(value);
    });
    
    
    //demo1
    var promise = new Promise(function(resolve, reject) {
        console.log('Promise');
        resolve();
    });

    promise.then(function() {
        console.log('resolved.');
    });

    console.log('Hi!');
    
    //异步加载图片
    var promise= new Promise(function(resolve, reject) {
        const image = new Image();
        let url = 'http://asdadcxxx823h2ke.com/1.jpg';
        image.onload = function() {
            resolve(image);
        };

        image.onerror = function() {
            reject(new Error('Could not load image at ' + url));
        };

        image.src = url ;
    });
    promise.then(function (value) {
        console.log(1)
    },function (reason) {
        console.log(reason)

    })
    
//    AJAX
    const getJSON = function(url) {
        const promise = new Promise(function(resolve, reject){
            const handler = function() {
                if (this.readyState !== 4) {
                    return;
                }
                if (this.status === 200) {
                    resolve(this.response);
                } else {
                    reject(new Error(this.statusText));
                }
            };
            const client = new XMLHttpRequest();
            client.open("GET", url);
            client.onreadystatechange = handler;
            client.responseType = "json";
            client.setRequestHeader("Accept", "application/json");
            client.send();
        
        });

        return promise;
    };

    // getJSON("http://www.baidu.com").then(function(json) {
    //     console.log('Contents: ' + json);
    // }, function(error) {
    //     console.error('出错了', error);
    // });
    
    
    //test
    var promise = new Promise((resolve, reject) => {
        let a = 1
        resolve(a);
        a++
        console.log(a);
    }).then(r => {
        console.log(r);
    });
</script>
</html>